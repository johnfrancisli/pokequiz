import { Question } from '../types/game';

// 各 question の options[0] が正解の読み仮名となるように保持しておく
export const questions: Question[] = [
  {
    id: 1,
    text: "意味",
    options: ["いみ", "いま", "うみ", "えいみ"],
    correctAnswer: 0
  },
  {
    id: 2,
    text: "役に立つ",
    options: ["やくにたつ", "やくにだつ", "やくにたち", "やくにたつう"],
    correctAnswer: 0
  },
  {
    id: 3,
    text: "使う",
    options: ["つかう", "つかい", "つかわ", "たすかう"],
    correctAnswer: 0
  },
  {
    id: 4,
    text: "短い",
    options: ["みじかい", "みじかお", "みじかく", "みじがい"],
    correctAnswer: 0
  },
  {
    id: 5,
    text: "自由のめがね",
    options: ["じゆうのめがね", "じゆうのめいがね", "じゆうのめつがね", "じうのめがね"],
    correctAnswer: 0
  },
  {
    id: 6,
    text: "体温",
    options: ["たいおん", "ていおん", "たいねつ", "たいおう"],
    correctAnswer: 0
  },
  {
    id: 7,
    text: "今度",
    options: ["こんど", "こんと", "こんとき", "こんどう"],
    correctAnswer: 0
  },
  {
    id: 8,
    text: "全部",
    options: ["ぜんぶ", "ぜんぷ", "ぜんぶつ", "ぜんぶん"],
    correctAnswer: 0
  },
  {
    id: 9,
    text: "全員",
    options: ["ぜんいん", "ぜんういん", "ぜんいんろ", "ぜんいあん"],
    correctAnswer: 0
  },
  {
    id: 10,
    text: "平がな",
    options: ["ひらがな", "ひらがね", "ひとがな", "ひらかな"],
    correctAnswer: 0
  },
  {
    id: 11,
    text: "重いかばん",
    options: ["おもいかばん", "おもいがばん", "おおもいかばん", "おもいかほん"],
    correctAnswer: 0
  },
  {
    id: 12,
    text: "等しい",
    options: ["ひとしい", "ひとしお", "ひとなしい", "ひとしいう"],
    correctAnswer: 0
  },
  {
    id: 13,
    text: "とても寒い",
    options: ["とてもさむい", "とてもさむえ", "とてもさむあ", "とてもしむい"],
    correctAnswer: 0
  },
  {
    id: 14,
    text: "決める",
    options: ["きめる", "きみる", "きめれ", "きめろう"],
    correctAnswer: 0
  },
  {
    id: 15,
    text: "道路",
    options: ["どうろ", "どうる", "どうろう", "どうろく"],
    correctAnswer: 0
  },
  {
    id: 16,
    text: "屋根",
    options: ["やね", "やねえ", "やねこ", "やねん"],
    correctAnswer: 0
  },
  {
    id: 17,
    text: "住んでいる",
    options: ["すんでいる", "すんでる", "すんでいく", "ずんでいる"],
    correctAnswer: 0
  },
  {
    id: 18,
    text: "拾う",
    options: ["ひろう", "ひろお", "ひろうう", "ひろおう"],
    correctAnswer: 0
  },
  {
    id: 19,
    text: "橋をわたる",
    options: ["はしをわたる", "はしをわたろ", "はしをわたれ", "はしをわたるう"],
    correctAnswer: 0
  },
  {
    id: 20,
    text: "坂道",
    options: ["さかみち", "さかみつ", "さかみちえ", "さかみちお"],
    correctAnswer: 0
  },
  {
    id: 21,
    text: "写真",
    options: ["しゃしん", "しゃしんう", "しゃじん", "しゃしにん"],
    correctAnswer: 0
  },
  {
    id: 22,
    text: "習う",
    options: ["ならう", "ならい", "ならえ", "ならおう"],
    correctAnswer: 0
  },
  {
    id: 23,
    text: "千葉県",
    options: ["ちばけん", "ちばけんう", "ちばけんえ", "ちばけに"],
    correctAnswer: 0
  },
  {
    id: 24,
    text: "去年",
    options: ["きょねん", "きょねむ", "きょねろ", "きょねんう"],
    correctAnswer: 0
  },
  {
    id: 25,
    text: "有名",
    options: ["ゆうめい", "ゆうまい", "ゆうねい", "ゆうめえ"],
    correctAnswer: 0
  },
  {
    id: 26,
    text: "笛をふく",
    options: ["ふえをふく", "ふえをふこ", "ふえをふき", "ふえをふくう"],
    correctAnswer: 0
  },
  {
    id: 27,
    text: "黒板",
    options: ["こくばん", "こくばんく", "こくばんう", "こくばんえ"],
    correctAnswer: 0
  },
  {
    id: 28,
    text: "始める",
    options: ["はじめる", "はじめろ", "はじめれ", "はじまる"],
    correctAnswer: 0
  },
  {
    id: 29,
    text: "勝つ",
    options: ["かつ", "かつえ", "かつお", "かつつ"],
    correctAnswer: 0
  },
  {
    id: 30,
    text: "苦手",
    options: ["にがて", "にがてえ", "にがてお", "にがてつ"],
    correctAnswer: 0
  },
  {
    id: 31,
    text: "係",
    options: ["かかり", "かかりう", "かかりく", "かかろう"],
    correctAnswer: 0
  },
  {
    id: 32,
    text: "育てる",
    options: ["そだてる", "そだてり", "そだてろ", "そだてわ"],
    correctAnswer: 0
  },
  {
    id: 33,
    text: "学級",
    options: ["がっきゅう", "がっきゅえう", "がっきゅお", "がっきゅい"],
    correctAnswer: 0
  },
  {
    id: 34,
    text: "倉庫",
    options: ["そうこ", "そうこう", "そうこお", "そうこえ"],
    correctAnswer: 0
  },
  {
    id: 35,
    text: "起きる",
    options: ["おきる", "おぎる", "おきろ", "おきれ"],
    correctAnswer: 0
  },
  {
    id: 36,
    text: "お礼する",
    options: ["おれいする", "おれいずる", "おれいるする", "おれういする"],
    correctAnswer: 0
  },
  {
    id: 37,
    text: "筆",
    options: ["ふで", "ふでく", "ふでお", "ふって"],
    correctAnswer: 0
  },
  {
    id: 38,
    text: "植物",
    options: ["しょくぶつ", "しょくぶち", "しょくぼつ", "しょくぶつう"],
    correctAnswer: 0
  },
  {
    id: 39,
    text: "荷物",
    options: ["にもつ", "にもち", "にもっつ", "にもつう"],
    correctAnswer: 0
  },
  {
    id: 40,
    text: "品物",
    options: ["しなもの", "しなのもの", "しなもに", "しなものう"],
    correctAnswer: 0
  },
  {
    id: 41,
    text: "木炭",
    options: ["もくたん", "もくたむ", "もくたに", "もくたんう"],
    correctAnswer: 0
  },
  {
    id: 42,
    text: "えだ豆",
    options: ["えだまめ", "えだまみ", "えだまむ", "えだませ"],
    correctAnswer: 0
  },
  {
    id: 43,
    text: "両方",
    options: ["りょうほう", "りょうぼう", "りょうほお", "りょうはう"],
    correctAnswer: 0
  },
  {
    id: 44,
    text: "太平洋",
    options: ["たいへいよう", "たいへいよ", "たいへいゆう", "たいへいよお"],
    correctAnswer: 0
  },
  {
    id: 45,
    text: "服そう",
    options: ["ふくそう", "ふくそお", "ふくさう", "ふこそう"],
    correctAnswer: 0
  },
  {
    id: 46,
    text: "三十秒",
    options: ["さんじゅうびょう", "さんじゅびょう", "さんじゅうびょお", "さんじゅうびょ"],
    correctAnswer: 0
  }
];

// Fisher–Yates アルゴリズムで配列をシャッフルするヘルパー関数
export function shuffleArray<T>(array: T[]): T[] {
  const arr = array.slice(); // 元データを壊さないようにコピー
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

export const getRandomQuestion = (): Question => {
  // ランダムに1問を選ぶ
  const randomIndex = Math.floor(Math.random() * questions.length);
  const original = questions[randomIndex];

  // options 全体をシャッフル
  const shuffledOptions = shuffleArray(original.options);

  // シャッフル後の配列内で、もともとの正解（options[0]）がどこに移ったか探す
  const correctReading = original.options[original.correctAnswer]; // ここでは常に options[0]
  const newCorrectIndex = shuffledOptions.findIndex(opt => opt === correctReading);

  return {
    id: original.id,
    text: original.text,
    options: shuffledOptions,
    correctAnswer: newCorrectIndex
  };
};

export function getQuestionWithShuffledOptions(question: Question): Question {
  if (!question) return question;
  
  // options 全体をシャッフル
  const shuffledOptions = shuffleArray(question.options);

  // シャッフル後の配列内で、もともとの正解がどこに移ったか探す
  const correctReading = question.options[question.correctAnswer];
  const newCorrectIndex = shuffledOptions.findIndex(opt => opt === correctReading);

  return {
    ...question,
    options: shuffledOptions,
    correctAnswer: newCorrectIndex
  };
}